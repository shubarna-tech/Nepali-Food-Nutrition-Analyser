{% extends 'myapp/base.html' %} {% load static %} {% block title %}Nutrition
Analytics Dashboard{% endblock %} {% block content %}
<div
  class="min-h-[70vh] bg-gradient-to-br from-green-50 via-emerald-100 to-green-200 py-10 px-2 md:px-0"
>
  <div class="max-w-6xl mx-auto flex flex-col gap-8">
    <!-- Header Card -->
    <div
      class="bg-white/90 rounded-3xl shadow-2xl p-8 flex flex-col items-center gap-2 animate-fade-in mb-2"
    >
      <span class="material-icons text-green-600 text-5xl mb-2">insights</span>
      <h2 class="text-4xl font-extrabold text-green-700 mb-1 text-center">
        Nutrition Analytics Dashboard
      </h2>
      <p class="text-lg text-gray-600 text-center">
        Monitor trends, spot insights, and help users eat smarter!
      </p>
    </div>
    <!-- Summary Cards: Total Nutrients Consumed -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
      <div
        class="bg-white rounded-2xl shadow-lg p-6 flex flex-col items-center"
      >
        <div class="text-gray-500">Total Calories</div>
        <div
          class="text-2xl font-bold text-green-700 flex items-baseline gap-1"
        >
          {{ nutrient_totals.total_calories|default:'0' }}<span
            class="text-base text-gray-500 ml-1"
            >kcal</span
          >
        </div>
      </div>
      <div
        class="bg-white rounded-2xl shadow-lg p-6 flex flex-col items-center"
      >
        <div class="text-gray-500">Total Protein</div>
        <div class="text-2xl font-bold text-blue-700 flex items-baseline gap-1">
          {{ nutrient_totals.total_protein|default:'0' }}<span
            class="text-base text-gray-500 ml-1"
            >g</span
          >
        </div>
      </div>
      <div
        class="bg-white rounded-2xl shadow-lg p-6 flex flex-col items-center"
      >
        <div class="text-gray-500">Total Fat</div>
        <div class="text-2xl font-bold text-pink-700 flex items-baseline gap-1">
          {{ nutrient_totals.total_fat|default:'0' }}<span
            class="text-base text-gray-500 ml-1"
            >g</span
          >
        </div>
      </div>
      <div
        class="bg-white rounded-2xl shadow-lg p-6 flex flex-col items-center"
      >
        <div class="text-gray-500">Total Carbs</div>
        <div
          class="text-2xl font-bold text-yellow-700 flex items-baseline gap-1"
        >
          {{ nutrient_totals.total_carbs|default:'0' }}<span
            class="text-base text-gray-500 ml-1"
            >g</span
          >
        </div>
      </div>
      <div
        class="bg-white rounded-2xl shadow-lg p-6 flex flex-col items-center"
      >
        <div class="text-gray-500">Total Fiber</div>
        <div
          class="text-2xl font-bold text-purple-700 flex items-baseline gap-1"
        >
          {{ nutrient_totals.total_fiber|default:'0' }}<span
            class="text-base text-gray-500 ml-1"
            >g</span
          >
        </div>
      </div>
    </div>
    <!-- Average Daily Intake Cards -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-6 mb-8">
      <div
        class="bg-white rounded-2xl shadow-lg p-6 flex flex-col items-center"
      >
        <div class="text-gray-500">Avg Daily Calories/User</div>
        <div
          class="text-2xl font-bold text-green-700 flex items-baseline gap-1"
        >
          {{ avg_nutrients.calories|default:'0' }}<span
            class="text-base text-gray-500 ml-1"
            >kcal</span
          >
        </div>
      </div>
      <div
        class="bg-white rounded-2xl shadow-lg p-6 flex flex-col items-center"
      >
        <div class="text-gray-500">Avg Daily Protein/User</div>
        <div class="text-2xl font-bold text-blue-700 flex items-baseline gap-1">
          {{ avg_nutrients.protein|default:'0' }}<span
            class="text-base text-gray-500 ml-1"
            >g</span
          >
        </div>
      </div>
      <div
        class="bg-white rounded-2xl shadow-lg p-6 flex flex-col items-center"
      >
        <div class="text-gray-500">Avg Daily Fat/User</div>
        <div class="text-2xl font-bold text-pink-700 flex items-baseline gap-1">
          {{ avg_nutrients.fat|default:'0' }}<span
            class="text-base text-gray-500 ml-1"
            >g</span
          >
        </div>
      </div>
      <div
        class="bg-white rounded-2xl shadow-lg p-6 flex flex-col items-center"
      >
        <div class="text-gray-500">Avg Daily Carbs/User</div>
        <div
          class="text-2xl font-bold text-yellow-700 flex items-baseline gap-1"
        >
          {{ avg_nutrients.carbs|default:'0' }}<span
            class="text-base text-gray-500 ml-1"
            >g</span
          >
        </div>
      </div>
      <div
        class="bg-white rounded-2xl shadow-lg p-6 flex flex-col items-center"
      >
        <div class="text-gray-500">Avg Daily Fiber/User</div>
        <div
          class="text-2xl font-bold text-purple-700 flex items-baseline gap-1"
        >
          {{ avg_nutrients.fiber|default:'0' }}<span
            class="text-base text-gray-500 ml-1"
            >g</span
          >
        </div>
      </div>
    </div>
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Main Chart: Nutrient Trends -->
      <div
        class="col-span-2 bg-white rounded-2xl shadow-lg p-8 flex flex-col items-center animate-fade-in"
      >
        <div class="flex justify-between items-center mb-4 w-full">
          <h3 class="text-xl font-semibold text-green-700 flex items-center">
            <span class="material-icons mr-2">show_chart</span> Nutrient Trends
            (Last 7 Days)
          </h3>
        </div>
        <div style="width: 100%; max-width: 700px">
          <canvas id="nutrientTrendsChart" height="220"></canvas>
        </div>
      </div>
      <!-- Side Widget: Most Common Foods & Fun Stat -->
      <div class="flex flex-col gap-8">
        <div class="bg-white rounded-2xl shadow-lg p-6 animate-fade-in">
          <h4
            class="text-md font-semibold text-gray-700 mb-4 flex items-center"
          >
            <span class="material-icons text-emerald-500 mr-1">restaurant</span>
            Most Common Foods
          </h4>
          <ul class="space-y-2">
            {% for food, count in common_foods %}
            <li class="flex items-center justify-between">
              <span class="font-medium">{{ food }}</span>
              <span class="text-xs text-gray-500">{{ count }} times</span>
            </li>
            {% endfor %}
          </ul>
        </div>
        <div
          class="bg-gradient-to-br from-yellow-100 to-yellow-200 rounded-2xl shadow-lg p-6 flex flex-col items-center animate-fade-in"
        >
          <span class="material-icons text-yellow-500 text-4xl mb-2"
            >emoji_events</span
          >
          <div class="text-lg font-semibold text-yellow-700 mb-1">
            Top User This Week
          </div>
          {% if top_user %}
          <div class="text-green-700 font-bold text-xl mb-1 flex items-center">
            <span class="material-icons mr-1 text-green-500">person</span> {{
            top_user.username }}
          </div>
          <div class="text-gray-600 text-center text-base">
            Logged
            <span class="font-bold">{{ top_user.meal_count }}</span> meals this
            week!
          </div>
          {% else %}
          <div class="text-gray-500 text-center">
            No user activity this week.
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block extra_scripts %}
<link
  href="https://fonts.googleapis.com/icon?family=Material+Icons"
  rel="stylesheet"
/>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{{ trend_labels|json_script:"trend-labels" }} {{
trend_calories|json_script:"trend-calories" }} {{
trend_protein|json_script:"trend-protein" }} {{
trend_fat|json_script:"trend-fat" }} {{ trend_carbs|json_script:"trend-carbs" }}
{{ trend_fiber|json_script:"trend-fiber" }}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const labels = JSON.parse(
      document.getElementById("trend-labels").textContent,
    );
    const calories = JSON.parse(
      document.getElementById("trend-calories").textContent,
    );
    const protein = JSON.parse(
      document.getElementById("trend-protein").textContent,
    );
    const fat = JSON.parse(document.getElementById("trend-fat").textContent);
    const carbs = JSON.parse(
      document.getElementById("trend-carbs").textContent,
    );
    const fiber = JSON.parse(
      document.getElementById("trend-fiber").textContent,
    );
    new Chart(document.getElementById("nutrientTrendsChart").getContext("2d"), {
      type: "line",
      data: {
        labels: labels,
        datasets: [
          {
            label: "Calories",
            data: calories,
            borderColor: "rgba(16,185,129,1)",
            backgroundColor: "rgba(16,185,129,0.1)",
            fill: false,
            tension: 0.3,
          },
          {
            label: "Protein",
            data: protein,
            borderColor: "rgba(59,130,246,1)",
            backgroundColor: "rgba(59,130,246,0.1)",
            fill: false,
            tension: 0.3,
          },
          {
            label: "Fat",
            data: fat,
            borderColor: "rgba(236,72,153,1)",
            backgroundColor: "rgba(236,72,153,0.1)",
            fill: false,
            tension: 0.3,
          },
          {
            label: "Carbs",
            data: carbs,
            borderColor: "rgba(245,158,11,1)",
            backgroundColor: "rgba(245,158,11,0.1)",
            fill: false,
            tension: 0.3,
          },
          {
            label: "Fiber",
            data: fiber,
            borderColor: "rgba(139,92,246,1)",
            backgroundColor: "rgba(139,92,246,0.1)",
            fill: false,
            tension: 0.3,
          },
        ],
      },
      options: {
        plugins: { legend: { display: true } },
        scales: { y: { beginAtZero: true } },
        animation: false,
        responsive: true,
        maintainAspectRatio: false,
      },
    });
  });
</script>
{% endblock %}

<style>
  @keyframes fade-in {
    from {
      opacity: 0;
      transform: translateY(24px);
    }
    to {
      opacity: 1;
      transform: none;
    }
  }
  .animate-fade-in {
    animation: fade-in 1s cubic-bezier(0.4, 0, 0.2, 1) both;
  }
</style>
